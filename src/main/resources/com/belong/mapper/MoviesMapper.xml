<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.belong.dao.MoviesMapper" >
  <resultMap id="BaseResultMap" type="com.belong.model.Movies" >
    <id column="Vid" property="vid" jdbcType="INTEGER" />
    <result column="Vname" property="vname" jdbcType="LONGVARCHAR" />
    <result column="Vdate" property="vdate" jdbcType="DATE" />
    <result column="id" property="id" jdbcType="INTEGER" />
    <result column="views" property="views" jdbcType="DECIMAL" />
    <result column="Vinfo" property="vinfo" jdbcType="LONGVARCHAR" />
    <result column="Vpic" property="vpic" jdbcType="LONGVARBINARY"/>
    <result column="Vsrc" property="vsrc" jdbcType="LONGVARCHAR" />
    <result column="v_type" property="v_type" jdbcType="INTEGER" />
    <association property="user"
                 column="id"
                 select="QueryUserByID"/>
  </resultMap>

  <select id="QueryUserByID" resultMap="com.belong.dao.UserMapper.BaseResultMap">
    SELECT username
    FROM user
    WHERE id = #{id,jdbcType=INTEGER}
  </select>

  <select id="getPath" resultType="java.lang.String" parameterType="map">
    SELECT Vsrc
    FROM movies
    WHERE Vid = #{vid,jdbcType=INTEGER}
  </select>

  <select id="getVType" resultType="java.lang.Integer" parameterType="map">
    SELECT v_type
    FROM movies
    WHERE Vid = #{vid,jdbcType=INTEGER}
  </select>

  <select id="getPic" parameterType="map"  resultType="com.belong.model.Movies" resultMap="BaseResultMap">
    SELECT Vpic
    FROM movies
    WHERE Vid = #{vid,jdbcType=INTEGER}
  </select>

  <select id="getTop20"  resultType="com.belong.model.Movies">
    SELECT Vname,Vid,Vdate
    FROM movies
    ORDER BY views desc limit 20
  </select>

  <select id="getVideosFromVname"  resultType="com.belong.model.Movies" parameterType="map">
    SELECT Vname,Vid,v_set
    FROM movies
    WHERE Vname = #{vname,jdbcType=VARCHAR}
    order by v_set desc
  </select>

  <select id="getVideosByVnameAndVinfo"  resultType="com.belong.model.Movies" resultMap="BaseResultMap" parameterType="map">
    SELECT Vname,Vdate,views,v_type,username,m.id,Vid
    FROM movies m
    join user u ON (m.id = u.id)
    WHERE Vname LIKE #{video_info,jdbcType=VARCHAR}
    or Vinfo LIKE #{video_info,jdbcType=VARCHAR};
  </select>

  <select id="getVideosLately10"  resultType="com.belong.model.Movies" resultMap="BaseResultMap">
    SELECT Vname,Vdate,views,v_type,username,m.id,Vid
    FROM movies m
    join user u ON (m.id = u.id)
    ORDER BY Vdate desc limit 10;
  </select>

  <update id="views" parameterType="map" >
    UPDATE movies
    SET views = views + 1
    WHERE Vid = #{vid,jdbcType=INTEGER}
  </update>

  <update id="updateVtypeByVid" parameterType="map" >
    UPDATE movies
    SET v_type = #{v_type,jdbcType=INTEGER}
    WHERE Vid = #{vid,jdbcType=INTEGER}
  </update>
</mapper>
